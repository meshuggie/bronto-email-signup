!function(e){"use strict";function s(){e(".notice").remove()}function i(e,s){var i='<li data-name="'+s+'" data-value="'+e+'">';return i+='<div class="field sort">',i+='<input type="hidden" name="broes_fields[]" value="'+e+'">',i+="<span>"+s+"</span>",i+='<span class="remove dashicons dashicons-no-alt"></span>',i+="</div>",i+='<div class="field">',i+='<input type="checkbox" id="'+s+'-required" name="broes_required_fields[]" value="'+e+'">',i+='<label for="'+s+'-required">Required</label>',i+="</div>",i+="</li>"}function a(e,s){s?(e.find("form").addClass("disabled"),e.find("fieldset").prop("disabled"),e.find(".loading").removeClass("hidden")):(e.find("form").removeClass("disabled"),e.find("fieldset").removeAttr("disabled"),e.find(".loading").addClass("hidden"))}e(window).on("load",function(){var n=e(".bronto-email-signup"),t=e(".sortable ul"),o=e(".sortable select");t.sortable(),a(n,!1),e(".sortable-form button").on("click",function(s){s.preventDefault();var a=e(this).parents(".sortable-form").find("option:selected"),n=a.val(),o=a.data("name");a.prop("disabled",!0).prop("selected",!1),t.append(i(n,o))}),e("body").on("click",".sortable .remove",function(){var s=e(this).parents("li"),i=s.data("value");s.data("name");s.remove(),o.find('option[value="'+i+'"]').prop("disabled",!1)});var r=e("#bronto-email-signup-form").validate({rules:{broes_api_key:"required"}});e("body").on("click","#bronto-email-signup-form .button",function(i){i.preventDefault();var t;"test-connection"==e(this).attr("name")?(e("#broes_test_email").rules("add",{required:!0,email:!0}),t="broes_add_contact"):(e("#broes_test_email").rules("remove"),t="broes_update_settings");var o=e(this).parents("#bronto-email-signup-form"),d={action:t,_ajax_nonce:broes.nonce,api_key:o.find("#broes_api_key").val(),webform_url:o.find("#broes_webform_url").val(),webform_secret:o.find("#broes_webform_secret").val(),contact:o.find("input[name=broes_contact]:checked").val(),list_ids:o.find("#broes_list_ids").val(),fields:o.find('input[name="broes_fields[]"]').map(function(){return e(this).val()}).get(),required_fields:o.find('input[name="broes_required_fields[]"]:checked').map(function(){return e(this).val()}).get(),email:o.find("#broes_test_email").val(),cta:o.find("#broes_cta").val(),success_message:o.find("#broes_success_message").val(),registered_message:o.find("#broes_registered_message").val()};return!!r.form()&&(a(n,!0),void e.post(broes.ajax_url,d,function(i){var o,r=e("broes_add_contact"==t?"#test-connection-form":".wrap");a(n,!1),"success"==i.result?(o='<div id="setting-error-settings_updated" class="updated settings-error notice is-dismissible">',o+="<p>"+i.message+"</p>",o+='<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>',o+="</div>"):(o='<div class="error">',o+="<p>"+i.message+"</p>",o+="</div>"),s(),r.prepend(o),"broes_update_settings"==t&&(e("#bronto-email-signup-form .hidden").length&&window.location.reload(!0),e("body").animate({scrollTop:0},350,"linear"))},"json"))}),e("body").on("click",".notice-dismiss",function(){s()})})}(jQuery);